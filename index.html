<!doctype html>
<html lang="ar">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>موقع وصفات - HTML/CSS/JS</title>
<style>
:root{--accent:#d97706;--muted:#666}
body{font-family:Arial,Helvetica,sans-serif;margin:0;background:#fff9f4;color:#111}
header{background:linear-gradient(90deg,var(--accent),#f97316);color:#fff;padding:20px}
.wrap{max-width:1000px;margin:0 auto;padding:16px}
.controls{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
input,select,textarea,button{font:inherit}
.search input{padding:8px;border-radius:8px;border:1px solid #eee;width:280px}
.smallbtn{padding:8px;border-radius:8px;border:1px solid #eee;background:#fff;cursor:pointer}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:12px}
.card{background:#fff;border-radius:10px;box-shadow:0 6px 14px rgba(0,0,0,0.06);overflow:hidden}
.photo{height:140px;background:#f3f4f6;background-size:cover;background-position:center}
.body{padding:10px}
.tag{display:inline-block;background:rgba(0,0,0,0.04);padding:4px 8px;border-radius:8px;margin:2px;font-size:13px}
.modal{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:none;align-items:center;justify-content:center;padding:16px}
.panel{background:#fff;border-radius:10px;padding:14px;max-width:900px;max-height:90vh;overflow:auto}
.show{display:flex}
footer{text-align:center;color:var(--muted);padding:12px}
@media(max-width:600px){.search input{width:100%}}
</style>
</head>
<body>
<header><div class="wrap"><h1>موقع وصفات - HTML/CSS/JS</h1><p style="margin:6px 0 0">نسخة ثابتة تعمل محليًا</p></div></header>
<main class="wrap">
  <div class="controls">
    <div class="search"><input id="q" placeholder="ابحث بوصفة أو مكون..."><button class="smallbtn" id="btn-search">بحث</button></div>
    <select id="cat" class="smallbtn"><option value="all">كل الفئات</option></select>
    <select id="time" class="smallbtn"><option value="any">كل الأوقات</option><option value="under30">أقل من 30</option></select>
    <button class="smallbtn" id="btn-add">➕ أضف</button>
    <button class="smallbtn" id="btn-favs">❤️ مفضلة</button>
    <button class="smallbtn" id="btn-reset">استعادة</button>
  </div>
  <section id="list" class="grid"></section>
</main>
<footer>يمكن رفع هذا المجلد إلى GitHub Pages بسهولة.</footer>

<!-- modals -->
<div id="modal-view" class="modal"><div class="panel" id="view-panel"><button id="close-view" style="float:right">✖</button><div id="view-content"></div></div></div>
<div id="modal-add" class="modal"><div class="panel"><button id="close-add" style="float:right">✖</button><h3>أضف وصفة</h3>
<form id="form-add">
  <input id="r-title" placeholder="اسم الوصفة" required style="width:100%;padding:8px;margin:6px 0"><input id="r-cat" placeholder="الفئة" required style="width:100%;padding:8px;margin:6px 0">
  <input id="r-time" placeholder="الوقت بالدقائق" style="width:100%;padding:8px;margin:6px 0">
  <textarea id="r-ingredients" placeholder="مكون كل سطر" style="width:100%;padding:8px;margin:6px 0"></textarea>
  <textarea id="r-steps" placeholder="خطوة كل سطر" style="width:100%;padding:8px;margin:6px 0"></textarea>
  <input id="r-img" placeholder="رابط صورة (اختياري)" style="width:100%;padding:8px;margin:6px 0">
  <div style="text-align:left"><button class="smallbtn" type="submit">حفظ</button><button id="cancel-add" class="smallbtn" type="button">إلغاء</button></div>
</form>
</div></div>

<script>
// بسيط وعملي
const EX = [
  {id:'r1',title:'كسكسي بالخضار',category:'رئيسية',time:45,servings:4,ingredients:['كسكسي','جزر','كوسة'],steps:['اطبخ الخضار','حضر الكسكس'],img:''},
  {id:'r2',title:'شوربة عدس',category:'شوربة',time:25,servings:3,ingredients:['عدس','بصل','جزر'],steps:['اقطع','اطبخ'],img:''},
  {id:'r3',title:'بسبوسة',category:'حلويات',time:40,servings:6,ingredients:['سميد','سكر'],steps:['اخلط','اخبز'],img:''}
];
const DB_KEY='recipes_db_v1',FAV_KEY='recipes_favs_v1';
function saveDB(d){localStorage.setItem(DB_KEY,JSON.stringify(d))}
function loadDB(){return JSON.parse(localStorage.getItem(DB_KEY)||'[]')}
function saveFavs(f){localStorage.setItem(FAV_KEY,JSON.stringify(f))}
function loadFavs(){return JSON.parse(localStorage.getItem(FAV_KEY)||'[]')}
if(!localStorage.getItem(DB_KEY)) saveDB(EX);

const listEl=document.getElementById('list'),qEl=document.getElementById('q'),catEl=document.getElementById('cat'),timeEl=document.getElementById('time');
function populateCats(){const db=loadDB();const s=new Set(db.map(r=>r.category));catEl.innerHTML='<option value="all">كل الفئات</option>'+[...s].map(c=>`<option value="${c}">${c}</option>`).join('')}
function render(recipes){if(!recipes) recipes=loadDB(); listEl.innerHTML=recipes.map(r=>`<article class="card"><div class="photo" style="${r.img? 'background-image:url('+r.img+')':''}"></div><div class="body"><strong>${r.title}</strong><div style="font-size:13px;color:#666">${r.category} · ${r.time} د</div><div style="margin-top:8px">${r.ingredients.slice(0,3).map(i=>`<span class="tag">${i}</span>`).join('')}</div><div style="margin-top:8px"><button class="smallbtn open" data-id="${r.id}">عرض</button> <button class="smallbtn fav" data-id="${r.id}">♡</button></div></div></article>`).join('')||'<p>لا توجد وصفات</p>';
  document.querySelectorAll('.open').forEach(b=>b.addEventListener('click',e=>openRecipe(e.target.dataset.id)));
  document.querySelectorAll('.fav').forEach(b=>b.addEventListener('click',toggleFav));
}
function toggleFav(e){const id=e.target.dataset.id;const f=loadFavs();const i=f.indexOf(id);if(i==-1)f.push(id);else f.splice(i,1);saveFavs(f);render();}
function applyFilters(){let db=loadDB();const q=qEl.value.trim().toLowerCase();if(catEl.value!=='all') db=db.filter(r=>r.category===catEl.value); if(timeEl.value==='under30') db=db.filter(r=>r.time<=30); if(q) db=db.filter(r=> (r.title+' '+r.ingredients.join(' ')+' '+r.steps.join(' ')).toLowerCase().includes(q)); render(db)}
document.getElementById('btn-search').addEventListener('click',applyFilters);
document.getElementById('btn-clear')?.addEventListener('click',()=>{qEl.value='';catEl.value='all';timeEl.value='any';render()});
document.getElementById('btn-favs').addEventListener('click',()=>{const f=loadFavs();const db=loadDB();render(db.filter(r=>f.includes(r.id)) )});
document.getElementById('btn-reset').addEventListener('click',()=>{if(confirm('استعادة؟')){saveDB(EX);saveFavs([]);populateCats();render();}});

// view modal
function openRecipe(id){const db=loadDB();const r=db.find(x=>x.id===id);if(!r) return alert('لا توجد'); document.getElementById('view-content').innerHTML=`<h2>${r.title}</h2><p>${r.category} · ${r.time} د · ${r.servings||1} أشخاص</p><h4>المكونات</h4><ul>${r.ingredients.map(i=>`<li>${i}</li>`).join('')}</ul><h4>التحضير</h4><ol>${r.steps.map(s=>`<li>${s}</li>`).join('')}</ol>`;document.getElementById('modal-view').classList.add('show')}
document.getElementById('close-view').addEventListener('click',()=>document.getElementById('modal-view').classList.remove('show'));

// add modal
document.getElementById('btn-add').addEventListener('click',()=>document.getElementById('modal-add').classList.add('show'));
document.getElementById('close-add').addEventListener('click',()=>document.getElementById('modal-add').classList.remove('show'));
document.getElementById('cancel-add').addEventListener('click',()=>document.getElementById('modal-add').classList.remove('show'));
document.getElementById('form-add').addEventListener('submit',e=>{e.preventDefault();const id='r'+Date.now();const r={id,title:document.getElementById('r-title').value,category:document.getElementById('r-cat').value||'عام',time:parseInt(document.getElementById('r-time').value)||30,servings:1,ingredients:document.getElementById('r-ingredients').value.split('\n').filter(Boolean),steps:document.getElementById('r-steps').value.split('\n').filter(Boolean),img:document.getElementById('r-img').value}; const db=loadDB();db.unshift(r);saveDB(db);populateCats();render();document.getElementById('form-add').reset();document.getElementById('modal-add').classList.remove('show')});

// init
populateCats();render();
</script>
</body>
</html>
